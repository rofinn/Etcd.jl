<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · Etcd.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Etcd.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" action="search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href="index.html">Home</a><ul class="internal"><li><a class="toctext" href="#Quickstart-1">Quickstart</a></li></ul></li><li><a class="toctext" href="api.html">API</a></li><li><a class="toctext" href="contributing.html">Contributing</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href="index.html">Home</a></li></ul><a class="edit-page" href="https://github.com/rofinn/Etcd.jl/blob/620e09eaada17aa6548c9f8ac30848dd364239bd/docs/src/index.md#L{line}"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Etcd.jl-1" href="#Etcd.jl-1">Etcd.jl</a></h1><p><a href="https://rofinn.github.io/Etcd.jl/stable/"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="stable"/></a> <a href="https://rofinn.github.io/Etcd.jl/latest/"><img src="https://img.shields.io/badge/docs-latest-blue.svg" alt="latest"/></a> <a href="https://travis-ci.org/rofinn/Etcd.jl"><img src="https://travis-ci.org/rofinn/Etcd.jl.svg?branch=master" alt="Build Status"/></a> <a href="https://codecov.io/gh/rofinn/Etcd.jl"><img src="https://codecov.io/gh/rofinn/Etcd.jl/branch/master/graph/badge.svg" alt="codecov"/></a></p><p>A Julia <a href="https://github.com/coreos/etcd">Etcd</a> client for the <a href="https://github.com/coreos/etcd/blob/master/Documentation/v2/api.md">etcd-v2 REST api</a>.</p><p><strong>NOTE</strong>: Responses from the etcd server containing valid json are parsed into julia <code>Dict</code>s and <code>Array</code>s, while a <code>String</code> representation is returned for all other successful HTTP requests. For a detailed summary of the etcd responses please review the <a href="https://github.com/coreos/etcd/blob/master/Documentation/v2/api.md">etcd api documentation</a>.</p><h2><a class="nav-anchor" id="Quickstart-1" href="#Quickstart-1">Quickstart</a></h2><pre><code class="language-julia">julia&gt; Pkg.add(&quot;Etcd&quot;)

julia&gt; using Etcd</code></pre><h3><a class="nav-anchor" id="Configure-the-Etcd-server-1" href="#Configure-the-Etcd-server-1">Configure the Etcd server</a></h3><p>The library defaults to Etcd server at 127.0.0.1:2379.</p><pre><code class="language-julia">cli = Etcd.connect(&quot;127.0.0.1&quot;, 2379, &quot;v2&quot;)</code></pre><p>Or you can specify the server ip address and port number.</p><pre><code class="language-julia">cli = Etcd.connect(&quot;172.17.42.1&quot;, 5001)</code></pre><h3><a class="nav-anchor" id="Using-Etcd-Client-1" href="#Using-Etcd-Client-1">Using Etcd Client</a></h3><h4><a class="nav-anchor" id="Get-all-machines-in-the-cluster-1" href="#Get-all-machines-in-the-cluster-1">Get all machines in the cluster</a></h4><pre><code class="language-julia">julia&gt; Etcd.connect(&quot;127.0.0.1&quot;, 2379, &quot;v2&quot;)

julia&gt; machines(cli)</code></pre><h4><a class="nav-anchor" id="Setting-Key-Values-1" href="#Setting-Key-Values-1">Setting Key Values</a></h4><pre><code class="language-julia">cli = Etcd.connect(&quot;127.0.0.1&quot;, 2379, &quot;v2&quot;)</code></pre><p>Set a value on the <code>/foo/bar</code> key:</p><pre><code class="language-julia">julia&gt; set(cli, &quot;/foo/bar&quot;, &quot;Hello World&quot;)</code></pre><p>Set a value on the <code>/foo/bar</code> key with a value that expires in 60 seconds:</p><pre><code class="language-julia">julia&gt; set(cli, &quot;/foo/bar&quot;, &quot;Hello World&quot;, ttl=60)</code></pre><p>Note that the ttl value can be set with all the following commands by specifying <code>ttl=ttl_expiry_time_in_seconds</code></p><p>Conditionally set a value on <code>/foo/bar</code> if the previous value was &quot;Hello world&quot;. <code>test_and_set</code> is an alias for <code>compare_and_swap</code>.</p><pre><code class="language-julia">julia&gt; cas(cli, &quot;/foo/bar&quot;, &quot;Goodbye Cruel World&quot;, prev_value=&quot;Hello World&quot;)</code></pre><p>You can also conditionally set a value based on the previous etcd index. Conditionally set a value on <code>/foo/bar</code> if the previous etcd index was 1818:</p><pre><code class="language-julia">julia&gt; cas(cli, &quot;/foo/bar&quot;,&quot; Goodbye Cruel World&quot;, prev_index=1818)</code></pre><p>Create a new key <code>/foo/boo</code>, only if the key did not previously exist:</p><pre><code class="language-julia">julia&gt; create(cli, &quot;/foo/boo&quot;, &quot;Hello World&quot;)</code></pre><p>Create a new dir <code>/fooDir</code>, only if the directory did not previously exist:</p><pre><code class="language-julia">julia&gt; createdir(cli, &quot;/fooDir&quot;)</code></pre><p>Update an existing key <code>/foo/bar</code>, only if the key already existed:</p><pre><code class="language-julia">julia&gt; update(cli, &quot;/foo/boo&quot;, &quot;Merhaba&quot;)</code></pre><p>You can also Create (<code>createdir</code>) or update (<code>updatedir</code>) a directory.</p><h4><a class="nav-anchor" id="Retrieving-key-values-1" href="#Retrieving-key-values-1">Retrieving key values</a></h4><p>Get the current value for a single key in the local etcd node:</p><pre><code class="language-julia">julia&gt; get(cli,&quot;/foo/bar&quot;)</code></pre><p>Add <code>recursive=true</code> to recursively list sub-directories.</p><p>Check for existence of a key:</p><pre><code class="language-julia">julia&gt; exists(cli,&quot;/foo/bar&quot;)
true</code></pre><h4><a class="nav-anchor" id="Deleting-keys-1" href="#Deleting-keys-1">Deleting keys</a></h4><p>Delete a key:</p><pre><code class="language-julia">julia&gt; createdir(cli, &quot;/foo/qux&quot;)
julia&gt; delete(cli, &quot;/foo/boo&quot;)</code></pre><p>Delete an empty directory:</p><pre><code class="language-julia">julia&gt; deletedir(cli, &quot;/foo/qux&quot;)</code></pre><p>Recursively delete a key and all child keys:</p><pre><code class="language-julia">julia&gt; get(cli, &quot;/foo&quot;, recursive=true)

julia&gt; deletedir(cli, &quot;/foo&quot;, recursive=true)

julia&gt; get(cli, &quot;/foo&quot;, recursive=true)</code></pre><p>Conditionally delete <code>/foo/bar</code> if the previous value was &quot;Hello world&quot;:</p><pre><code class="language-julia">julia&gt; create(cli, &quot;/foo/bar&quot;, &quot;bar value&quot;)

julia&gt; cad(cli, &quot;/foo/bar&quot;, prev_value=&quot;bar value&quot;)</code></pre><p>Conditionally delete <code>/foo/bar</code> if the previous etcd index was 1849:</p><pre><code class="language-julia">julia&gt;create(cli, &quot;/foo/bar&quot;, &quot;Hello World&quot;)

julia&gt; cad(cli, &quot;/foo/bar&quot;, prev_index=1849)</code></pre><h4><a class="nav-anchor" id="Watching-for-changes-1" href="#Watching-for-changes-1">Watching for changes</a></h4><p>You can also create asynchronous watch routines with <code>watch</code> or <code>watchloop</code>. These methods will return the executed watch <code>Task</code>.</p><p>Watch for only the next change on a key:</p><pre><code class="language-julia">julia&gt; t = watch(resp -&gt; println(&quot;I&#39;m watching you: $resp&quot;), cli, &quot;/foo/bar&quot;)</code></pre><p>To continuously watch a key:</p><pre><code class="language-julia">julia&gt; t = watchloop(cli, &quot;/foo/bar&quot;; recursive=true) do resp
    # Run some code with response
end</code></pre><p>A termination condition (a <code>Function</code> which takes the etcd response and returns a <code>Bool</code>) can be used to exit the watch loop:</p><pre><code class="language-julia">julia&gt; predicate(r) = r[&quot;node&quot;][&quot;modifiedIndex&quot;] &gt; 5

julia&gt; t = watchloop(cli, &quot;/foo&quot;, predicate; recursive=true) do resp
    # Run some code with response
end</code></pre><p>You can also specify the following options:</p><ul><li><p><code>recursive=true</code> to watch the key and all it&#39;s children.</p></li><li><p><code>wait_index</code> to watch starting with the provided index.</p></li></ul><h4><a class="nav-anchor" id="Getting-cluster-information-1" href="#Getting-cluster-information-1">Getting cluster information</a></h4><p>You can retrieve Etcd stats by specifying one of <code>store</code>, <code>self</code> or <code>leader</code>.</p><p>For example to get the <code>store</code> stats:</p><pre><code class="language-julia">julia&gt; stats(etcd, &quot;store&quot;)</code></pre><p>You can also get the current leader with:</p><pre><code class="language-julia">julia&gt; leader(etcd)</code></pre><p>or a list of members with:</p><pre><code class="language-julia">julia&gt; members(etcd)</code></pre><h4><a class="nav-anchor" id="Logging-1" href="#Logging-1">Logging</a></h4><p>To aid development and debugging Etcd supports <a href="https://github.com/invenia/Memento.jl">Memento</a> logging of HTTP response bodies.</p><p>To get etcd HTTP debug logs run:</p><pre><code class="language-julia">julia&gt; using Memento

julia&gt; Memento.config(&quot;debug&quot;; fmt=&quot;[{level}] {msg}&quot;)
Logger(root)

julia&gt; set(cli, &quot;/foo/bar&quot;, &quot;Hello World&quot;)
[debug] {&quot;action&quot;:&quot;set&quot;,&quot;node&quot;:{&quot;key&quot;:&quot;/foo/bar&quot;,&quot;value&quot;:&quot;Hello World&quot;,&quot;modifiedIndex&quot;:4,&quot;createdIndex&quot;:4}}</code></pre><footer><hr/><a class="next" href="api.html"><span class="direction">Next</span><span class="title">API</span></a></footer></article></body></html>
